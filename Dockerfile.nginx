# --- STAGE 1: Build Frontend ---
FROM node:20-alpine AS frontend-builder
WORKDIR /app

# –°–Ω–∞—á–∞–ª–∞ —Ç–æ–ª—å–∫–æ package.json (–¥–ª—è –∫–µ—à–∞)
COPY front/package*.json ./
RUN npm ci

# –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
COPY front/ ./
RUN npm run build

# üî•üî•üî• –û–¢–õ–ê–î–û–ß–ù–ê–Ø –ö–û–ú–ê–ù–î–ê! üî•üî•üî•
# –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –≤—ã–≤–µ–¥–µ—Ç –≤ –ª–æ–≥ —Å–±–æ—Ä–∫–∏ –≤—Å—ë –¥–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ –≤ /app
# –ú—ã —É–≤–∏–¥–∏–º, —Å–æ–∑–¥–∞–ª–∞—Å—å –ª–∏ –ø–∞–ø–∫–∞ "dist" –∏ —á—Ç–æ —É –Ω–µ–µ –≤–Ω—É—Ç—Ä–∏.
RUN ls -R

# --- STAGE 2: Nginx ---
FROM nginx:alpine
COPY --from=frontend-builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf

RUN apk add --no-cache brotli

EXPOSE 80 443
CMD ["nginx", "-g", "daemon off;"]